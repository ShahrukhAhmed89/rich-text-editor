/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR 1.0.4
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,n,t){function G(e){return n[i](e)}function J(e){return e.toLowerCase()}function Q(e){return"undefined"==typeof e}function V(e){return"function"==typeof e}var P,r="__instance__",i="createElement",o="innerHTML",f="className",s="addEventListener",a="appendChild",l="parentNode",c="children",d="firstChild",p="insertBefore",g="nodeName",b="getAttribute",v="setAttribute",h="removeAttribute",x="replace",m="replaceChild",y="value",$="length",k="indexOf",w="preventDefault",C="focus",A="test",S="contenteditable",E="spellcheck",L="placeholder",_="getSelection",N="getRangeAt",j="rangeCount",T="cloneContents",B="deleteContents",H="addRange",K="insertNode",I="cloneRange",O="removeAllRanges",U="collapse",F="execCommand",D=null,M="ctrlKey",q="shiftKey",X="keyCode",Y=setTimeout;!function(e){e.version="1.0.4",e[r]={},e.each=function(n,t){return Y(function(){var i,t=e[r];for(i in t)n(t[i],i,t)},0===t?0:t||1),e}}(e[t]=function(i,u){function ae(){return P=e[_]&&e[_]()||{},P[j]&&P||D}function ue(e){return P=ae(),P&&P[N](e||0)||D}function le(e,n){if(e){if(P=ae()){var r,i,t=G("div");for(r=0,i=P[j];i>r;++r)t[a](P[N](r)[T]());return e=t[o],Q(n)||n?Le(e):e}return""}return ae()+""}function ce(e){var r,i,n=ue().commonAncestorContainer[l],t=J(n[g]);if(e){if(n=n!==te&&t===e?n:D,!n&&(n=ue())&&(n=n[c])){for(r=0,i=n[$];i>r;++r)if(J(n[r][g]||"")===e)return n[r];return D}return n}return t}function de(e){return(P=ue())&&(e=-1===e?!1:1===e?!0:e,P[U](e)),R}function pe(e,t){var r,i,f,s,u,l,c=G("div");if(r=ae()){for(i=ue(),i[B](),c[o]=e,f=n.createDocumentFragment();s=c[d];)l=f[a](s);u=f[d],i[K](f),l&&(i=i[I](),i.setStartAfter(l),t===!0?i.setStartBefore(u):de(t),r[O](),r[H](i))}return f}function ge(e,t,r){if(t&&t[b](S))try{n[F](e,!1,r)}catch(i){}}function be(t,r){if(t&&t[b](S))try{var f,i=ce("a");if(r){r=r[x](/^\s*javascript:/i,"");var s=r[0],t=e.location.hostname;s="/"===s||"?"===s||"&"===s||-1===r[k]("/"),!t||0!==r[k]("//"+t)&&-1===r[k]("://"+t)||(s=1),n[F]("createLink",!1,r),i=ae().focusNode,3===i.nodeType&&(i=i[l]),i&&i.href&&(s?(i[h]("rel"),i[h]("target")):(i[v]("rel","nofollow"),i[v]("target","_blank")))}else i&&(i.href="#"),n[F]("unlink",!1,!1),i&&i[l]&&(f=G("div"),f[o]=i[o],i[l][m](f[d],i))}catch(a){}}function ve(){return P=ae(),P||""===le()?ue()[I]()||D:D}function he(e){return e&&(P=ae())&&(P[O](),P[H](e)),R}function xe(e){e.selectionStart=e.selectionEnd=e[y][$],e[C]()}function Ee(e,n){return new RegExp(e,n)}function Le(e){return e=e[x](/\r/g,""),e=e[x](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,n){return"<code>"+n[x](/\n/g,ie)[x](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[x](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,n,t,r){if(t=J(t),!Ee("^("+Ce+"|"+Re+")$")[A](t))return"";r=r||"";var i=/^(h[1-6]|th)$/[A](t);/^((fig)?caption)$/[A](t);return"br"===t||"p"===t?"<"+n+t+">":"b"===t||"strong"===t||i?"<"+n+"strong>"+(i&&n?ie+ie:""):"i"===t||"em"===t?"<"+n+"em>":Ee("^("+Ce+")$")[A](t)?/\bfont-weight:\s*bold\b/[A](r)?"<"+n+"strong>":/\bfont-style:\s*italic\b/[A](r)?"<"+n+"em>":/\btext-decoration:\s*underline\b/[A](r)?"<"+n+"u>":"<"+n+t+r+">":Ee("^("+Re+")$")[A](t)?n?"":ie:""}),e=e[x](/<\/p>\s*<p>/g,"</p><p>")[x](/\s*<br\s*\/?>\s*/g,ie)[x](/\n/g,ie)[x](Ee("(?:"+ie+"){3,}","g"),ie+ie)[x](Ee("^(?:(?:"+ie+")+)|(?:(?:"+ie+")+)$"),"")[x](Ee(ie+ie,"g"),"</p><p>")[x](/<p><\/p>/g,""),e=e&&!/^\s*<p>([\s\S]*?)<\/p>\s*$/i[A](e)?"<p>"+e+"</p>":e}function _e(){te[o]=Le(i[y])[x](/<\/p>\s*<p>/g,ie+ie)[x](/<\/?p>/g,"")}function Ne(){i[y]=Le(te[o])[x](/<\/p><p>/g,"</p>\n<p>")}function je(e,n,t,r){function a(e){r.apply(this,[e]),Ne(),te[C](),V($e)&&$e(e,R,te),e[w]()}var i=G("a");return i[f]=n,i[o]="<span>"+(t[1]||t[0])+"</span>",i.title=e,i.href="javascript:;",i[s]("touchstart",a,!1),i[s]("mousedown",a,!1),[i,r]}function Te(e){return J(e.key||String.fromCharCode(e[X]))}var oe,fe,se,R=this,z="⌘",W="⇧",Z={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],tools:["b","i","u","x"],text:{b:["Bold","&#x0042;",z+"+B"],i:["Italic","&#x0049;",z+"+I"],u:["Underline","&#x0055;",z+"+U"],a:["Link","&#x2693;",z+"+L"],x:["Source","&#x22EF;",z+"+"+W+"+X"]},enter:1,x:0,update:0},ee=G("span"),ne=G("span"),te=G("span"),re=G("span"),ie="<br>";R.$=[D,D],R.s=ve,R.r=he,R.e=ce,R.v=le,R.i=pe,R.t=function(){},R.c=de,R.d=function(e,n,t){R.$[0]=ve();var r=re[c][0];return r[L]=e,r[y]=n,Y(function(){xe(r)},1),oe=t,R.d.v(),R},R.d.x=function(e){return re.style.display="none",R.is.d=!1,e&&he(R.$[0]),R},R.d.v=function(){return re.style.display="block",R.is.d=!0,R},e[t][r][i.id||i.name||Object.keys(e[t][r])[$]]=R,u=u||{};for(se in Z)Q(u[se])||(Z[se]=u[se]);R.is={view:!0,source:!1,d:!1};var me=Z.enter,ye=Z.x,$e=Z.update,ke=Z.classes[0],we=Z.text||{},Ce=Z.tags.join("|"),Re="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|p(re)?|t(able|[dh])",Ae=0,Se={b:function(){ge("bold",te)},i:function(){ge("italic",te)},u:function(){ge("underline",te)},a:function(e){var t,n=le();/^[a-z\d]+:\/\/\S+$/[A](n)?be(te,n):(t=ce("a"),R.d("http://",(t?t.href[x](/\/+$/,""):"http://"+J(n[x](/\s/g,"")))||"",function(e,n,t){be(te,t[y])}))},x:function(e){var n=te.offsetHeight;n&&(i.style.minHeight=n+"px"),Ae?(R.$[1]=ve(),ee[f]=ee[f][x](/\s+source$/,""),te[C](),he(R.$[0]),Ae=0):(R.$[0]=ve(),ee[f]+=" source",xe(i),he(R.$[1]),Ae=1),R.is={view:!Ae,source:!!Ae},R.d.x(),V(ye)&&ye(e,R,Ae||0)}};for(se in Se)R.t[se]=Se[se],Se[se]=je(we[se][0]+(we[se][2]?" ("+we[se][2]+")":""),ke+"-"+se,we[se],Se[se]);_e(),Ne(),ee[f]=ke,i[f]=ke+"-source",i[v](E,!1),ne[f]=ke+"-tool",te[f]=ke+"-view",me&&(ee[f]+=" expand"),te[v](S,!0),te[v](E,!1),te[v](L,i[L]||""),te[s]("paste",function(){Y(_e,1)},!1),te[s]("keydown",function(e){var f,n=e[M],t=e[q],r=e[X],i=ee,o=Te(e);if(!n||t||"b"!==o&&66!==r)if(!n||t||"i"!==o&&73!==r)if(!n||t||"u"!==o&&85!==r)if(!n||t||"l"!==o&&76!==r){if(n&&t&&("x"===o||88===r))Se.x[1](),e[w]();else if(!t&&("enter"===o||13===r)){var s=ae(),a=ue(),u=G("br");if(me&&a&&(a[B](),a[K](u),a.setStartAfter(u),a.setEndAfter(u),s[O](),s[H](a),e[w]()),me)V(me)&&me(e,R,te);else{for(;i=i[l];)if("form"===J(i[g])){f=i;break}f&&f.submit()}}}else Se.a[1](),e[w]();else Se.u[1](),e[w]();else Se.i[1](),e[w]();else Se.b[1](),e[w]();V($e)&&$e(e,R,te),Y(Ne,1)},!1),i[s]("keydown",function(e){var n=e[M],t=e[q],r=e[X],o=Te(e);n&&t&&("x"===o||88===r)?(Se.x[1](),e[w]()):t||"enter"!==o&&13!==r||V(me)&&me(e,R,i),V($e)&&$e(e,R,i),Y(_e,1)},!1),fe=Z.tools;for(se in fe)Se[fe[se]]&&ne[a](Se[fe[se]][0]);ee[a](te),i[l][p](ee,i),ee[a](i),ee[a](ne),re[f]=ke+"-dialog",re[o]='<input type="text">',R.d.x();var Be=re[c][0];return Be[v](E,!1),Be[s]("keydown",function(e){var n=this,t=e[M],r=e[q],i=e[X],o=Te(e);t||r||"enter"!==o&&13!==i?r||"escape"!==o&&27!==i&&(n[y][$]||"backspace"!==o&&8!==i)||(R.d.x(1),te[C](),oe=0,e[w]()):(R.d.x(1),te[C](),oe&&(oe(e,R,n),oe=0,e[w]()))},!1),ee[a](re),R.container=ee,R.view=te,R.target=R.source=i,R.tool=ne,R.dialog=re,R.config=Z,R.f=Le,R})}(window,document,"RTE");