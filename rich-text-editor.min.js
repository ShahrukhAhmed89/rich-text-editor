/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR 1.0.4
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,t,n){function te(e){return t[r](e)}function ne(e){return e.toLowerCase()}function ie(e){return"undefined"==typeof e}function re(e){return"function"==typeof e}function fe(e,t){return new RegExp(e,t)}var B,L,i="__instance__",r="createElement",f="innerHTML",o="className",s="addEventListener",u="appendChild",a="removeChild",c="parentNode",l="children",p="firstChild",d="insertBefore",g="nodeName",v="getAttribute",b="setAttribute",h="removeAttribute",x="replace",$="value",y="length",w="indexOf",k="preventDefault",C="focus",S="blur",N="select",E="test",A="contenteditable",R="spellcheck",j="placeholder",T="getSelection",_="getRangeAt",H="rangeCount",K="addRange",D="removeAllRanges",I="cloneContents",O="deleteContents",F="selectNodeContents",z="insertNode",q="cloneRange",M="collapse",X="setStartBefore",G="setStartAfter",Q=null,V="ctrlKey",W="shiftKey",Z="keyCode",ee=setTimeout;!function(e){e.version="1.0.4",e[i]={},e.each=function(t,n){return ee(function(){var r,n=e[i];for(r in n)t(n[r],r,n)},0===n?0:n||1),e},e.x="​"}(e[n]=function(r,m){function ve(){return B=e[T]&&e[T]()||{},B[H]&&B||Q}function be(e){return B=ve(),B&&B[_](e||0)||Q}function he(e,t){if(e){if(B=ve()){var i,r,n=te("div");for(i=0,r=B[H];r>i;++i)n[u](B[_](i)[I]());return e=n[f].split(le).join(""),ie(t)||t?Ke(e):e}return""}return ve()+""}function xe(e){B=ve();var n,t=B.focusNode;return t?(3===t.nodeType&&t[c]!==ue&&(t=t[c]),n=ne(t[g]),e?n===e?t:Q:t):Q}function me(e){return(L=be())&&(e=1===e?!1:0===e?!0:e,L[M](e)),U}function $e(e,n){var i,r,o,s,a=te("div");if(B=ve()){for(L=be(),L[O](),a[f]=e,i=t.createDocumentFragment();r=a[p];)s=i[u](r);o=i[p],L[z](i),s&&(L=L[q](),L[G](s),n===!0?L[X](o):(1===n?n=0:0===n&&(n=1),me(n)),B[D](),B[K](L))}return o}function ye(t,n){if(t&&t[v](A))try{var o,i=xe("a"),r=he(1)[x](/^<p>|<\/p>$|<a(\s[^<>]*?)?>|<\/a>/g,"");n=n[x](/^\s*javascript:/i,"");var s=n[0],t=e.location.hostname;s="/"===s||"?"===s||"&"===s||-1===n[w]("/"),!t||0!==n[w]("//"+t)&&-1===n[w]("://"+t)||(s=1),n?(i?i[b]("href",n):(o=$e('<a href="'+n+'">'+r+"</a>",!0),be()[F](o)),(i=xe("a"))&&(s?(i[h]("rel"),i[h]("target")):(i[b]("rel","nofollow"),i[b]("target","blank")))):(i&&(r=i[f],i[c][a](i)),$e(r,!0))}catch(u){}}function we(){return B=ve(),B||""===he()?be()[q]()||Q:Q}function ke(e){return e&&(B=ve())&&(B[D](),B[K](e)),U}function Ce(e,t,n){ie(t)&&(t=-1);var o,s,i=xe(e),r=he(1)[x](fe("^<p>|<\\/p>$|<"+e+"(?:\\s[^<>]*?)?>|<\\/"+e+">","g"),"");return i!==ue&&(0===t||-1===t&&i?i&&(s=i[f])&&(i[c][a](i),o=$e(r||s,!0)):(1===t||-1===t&&!i)&&(o=$e("<"+e+">"+r+"</"+e+">",!0)),o&&(L=be(),L&&L[F](o),!r&&n&&$e(n,!0))),o}function Se(e){e.selectionStart=e.selectionEnd=e[$][y],e[C]()}function He(e,t,n,i){function u(e){i.apply(this,[e,U,r]),Ie(),ue[C](),re(Ae)&&Ae(e,U,ue),e[k]()}var r=te("a");return r[o]=t,r[f]="<span>"+(n[1]||n[0])+"</span>",r.title=e,r.href="javascript:;",i&&(r[s]("touchstart",u,!1),r[s]("mousedown",u,!1)),[r,i]}function Ke(e){return e=e[x](/\r/g,""),e=e[x](/<([\w-]+?)(?:\s[^<>]*?)?>\s*<\/([\w-]+?)>/g,function(e,t,n){return t===n?"":e}),e=e[x](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,t){return"<code>"+t[x](/\n/g,ce)[x](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[x](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,t,n,i){if(n=ne(n),!fe("^("+Be+"|"+Le+")$")[E](n))return"";i=i||"";var r=/^(h[1-6]|th)$/[E](n),o=(/^((fig)?caption)$/[E](n),t?"":i);return"br"===n||"p"===n?"<"+t+n+">":"b"===n||"strong"===n||r?"<"+t+"strong"+o+">"+(r&&t?ce+ce:""):"i"===n||"em"===n?"<"+t+"em"+o+">":fe("^("+Be+")$")[E](n)?"<"+t+n+o+">":fe("^("+Le+")$")[E](n)?ce+ce:""}),e=e[x](/<\/p>\s*<p>/g,"</p><p>")[x](/\s*<br\s*\/?>\s*/g,ce)[x](/\n/g,ce)[x](fe("(?:"+ce+"){3,}","g"),ce+ce)[x](fe("^(?:(?:"+ce+")+)|(?:(?:"+ce+")+)$"),"")[x](fe(ce+ce,"g"),"</p><p>")[x](/<p><\/p>/g,""),e=e&&!/^\s*<p>([\s\S]*?)<\/p>\s*$/i[E](e)?"<p>"+e+"</p>":e,e.split(le).join("")}function De(){ue[f]=Ke(r[$])[x](/<\/p>\s*<p>/g,ce+ce)[x](/<\/?p>/g,"")}function Ie(){r[$]=Ke(ue[f])[x](/<\/p><p>/g,"</p>\n<p>")}function Oe(e){return ne(e.key||String.fromCharCode(e[Z]))}var pe,de,ge,U=this,J="⌘",P="⇧",Y={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],tools:["b","i","u","x"],text:{b:["Bold","&#x0042;",J+"+B"],i:["Italic","&#x0049;",J+"+I"],u:["Underline","&#x0055;",J+"+U"],a:["Link","&#x2693;",J+"+L"],x:["Source","&#x22ef;",J+"+"+P+"+X"]},enter:1,x:0,update:0},oe=te("span"),se=te("span"),ue=te("span"),ae=te("span"),ce="<br>",le=e[n].x;U.$=[Q,Q],U.$$=function(e,t){return L=[ve(),be(t)],ie(e)?L:L[e]},U.d=function(e,t,n){U.$[0]=we();var i=ae[l][0];return i[j]=e,i[$]=t,ee(function(){Se(i)},1),pe=n,U.d.v(1),U},U.d.x=function(e){return ae.style.display="none",U.is.d=!1,e&&ke(U.$[0]),U},U.d.v=function(e){return ae.style.display="block",U.is.d=!0,e&&(U.$[0]=we()),U},e[n][i][r.id||r.name||Object.keys(e[n][i])[y]]=U,m=m||{};for(ge in Y)ie(m[ge])||(Y[ge]=m[ge]);U.is={view:!0,source:!1,d:!1,e:function(e){return"string"==typeof e?xe(e)?!0:!1:xe()===e}};var Ne=Y.enter,Ee=Y.x,Ae=Y.update,Re=Y.classes[0],je=Y.text||{},Be=Y.tags.join("|"),Le="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|p(re)?|t(able|[dh])",Te=0,_e={b:function(){Ce("strong")},i:function(){Ce("em")},u:function(){Ce("u")},a:function(e){var n,i,t=he();/^[a-z\d]+:\/\/\S+$/[E](t)?ye(ue,t):((n=xe("a"))&&(i=n[v]("href")),U.d("http://",(i?i[x](/\/+$/,""):"http://"+ne(t[x](/\s/g,"")))||"",function(e,t,n){ye(ue,n[$])}))},x:function(e){var t=ue.offsetHeight;t&&(r.style.minHeight=t+"px"),Te?(U.$[1]=we(),oe[o]=oe[o][x](/\s+source$/,""),ue[C](),ke(U.$[0]),Te=0):(U.$[0]=we(),oe[o]+=" source",Se(r),ke(U.$[1]),Te=1),U.is.view=!Te,U.is.source=!!Te,U.d.x(),re(Ee)&&Ee(e,U,Te||0)}};U.t=function(e,t,n,i){var r=He(t[0]+(t[2]?" ("+t[2]+")":""),Re+"-t:"+e,t,n);return ie(i)?i=Q:0>i&&(i=se[l][y]+i),se[d](r[0],se[l][i]||Q),r[0]};for(ge in _e)U.t[ge]=_e[ge],_e[ge]=He(je[ge][0]+(je[ge][2]?" ("+je[ge][2]+")":""),Re+"-t:"+ge,je[ge],_e[ge]),U.t[ge].e=_e[ge][0];De(),Ie(),oe[o]=Re,r[o]=Re+"-source",r[b](R,!1),se[o]=Re+"-tool",ue[o]=Re+"-view",Ne&&(oe[o]+=" expand"),ue[b](A,!0),ue[b](R,!1),ue[b](j,r[j]||""),ue[s](S,Ie,!1),ue[s]("paste",function(){ee(function(){De();var e=ue[f];ue[f]="",$e(e,0)},1)},!1),ue[s]("keydown",function(e){var o,t=e[V],n=e[W],i=e[Z],r=oe,f=Oe(e);if(!t||n||"b"!==f&&66!==i)if(!t||n||"i"!==f&&73!==i)if(!t||n||"u"!==f&&85!==i)if(!t||n||"l"!==f&&76!==i){if(t&&n&&("x"===f||88===i))_e.x[1](),e[k]();else if(!n&&("enter"===f||13===i))if(Ne&&(B=ve(),L=be(),$e(ce,0),$e(le,1),e[k]()),Ne)re(Ne)&&Ne(e,U,ue);else{for(;r=r[c];)if("form"===ne(r[g])){o=r;break}o&&o.submit()}}else _e.a[1](),e[k]();else _e.u[1](),e[k]();else _e.i[1](),e[k]();else _e.b[1](),e[k]();re(Ae)&&Ae(e,U,ue),ee(Ie,1)},!1),r[s]("keydown",function(e){var t=e[V],n=e[W],i=e[Z],f=Oe(e);t&&n&&("x"===f||88===i)?(_e.x[1](),e[k]()):n||"enter"!==f&&13!==i||re(Ne)&&Ne(e,U,r),re(Ae)&&Ae(e,U,r),ee(De,1)},!1),de=Y.tools;for(ge in de)_e[de[ge]]&&se[u](_e[de[ge]][0]);oe[u](ue),r[c][d](oe,r),oe[u](r),oe[u](se),ae[o]=Re+"-dialog",ae[f]='<input type="text">',U.d.x();var Ue=ae[l][0];return Ue[b](R,!1),Ue[s]("keydown",function(e){var t=this,n=e[V],i=e[W],r=e[Z],f=Oe(e);n||i||"enter"!==f&&13!==r?i||"escape"!==f&&27!==r&&(t[$][y]||"backspace"!==f&&8!==r)||(U.d.x(1),ue[C](),pe=0,e[k]()):(U.d.x(1),ue[C](),pe&&pe(e,U,t),pe=0,re(Ae)&&Ae(e,U,ue),e[k]())},!1),oe[u](ae),U.container=oe,U.view=ue,U.target=U.source=r,U.tool=se,U.dialog=ae,U.config=Y,U.c=me,U.e=xe,U.f=Ke,U.i=$e,U.r=ke,U.s=we,U.v=he,U.w=Ce,U[C]=function(){return U.is.view?ue[C]():U.is.source&&r[C](),U},U[S]=function(){return U.is.view?ue[S]():U.is.source&&r[S](),U},U[N]=function(){return U[C](),U.is.view?(L=t.createRange(),L[F](ue),B=ve(),B[D](),B[K](L)):U.is.source&&r[N](),U},U.disable=function(){return ue[h](A),r[b]("readonly",!0),U},U.enable=function(){return ue[b](A,!0),r[h]("readonly"),B},U})}(window,document,"RTE");