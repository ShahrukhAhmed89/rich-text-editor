/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,n,t){function k(e,t,r){if(t&&t[b]("contenteditable"))try{n.execCommand(e,r)}catch(i){}}function w(e){return n[i](e)}var r="__instance__",i="createElement",o="innerHTML",s="className",u="toLowerCase",f="addEventListener",c="appendChild",a="parentNode",l="insertBefore",b="getAttribute",p="setAttribute",d="replace",g="value",h="preventDefault",m="focus",y="test",v=setTimeout;!function(e){e.version="1.0.0",e[r]={},e.each=function(n,t){return v(function(){var i,t=e[r];for(i in t)n(t[i],i,t)},0===t?0:t||1),e}}(e[t]=function(n,i){function q(e,n){return new RegExp(e,n)}function D(e){return e=e[d](/\r/g,""),e=e[d](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,n){return"<code>"+n[d](/\n/g,"<br>")[d](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[d](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,n,t,r){if(t=t[u](),!q("^("+L+"|"+N+")$")[y](t))return"";r=r||"";var i=/^(h[1-6]|th)$/[y](t);/^((fig)?caption)$/[y](t);return"br"===t||"p"===t?"<"+n+t+">":"b"===t||"strong"===t||i?"<"+n+"strong>"+(i&&n?"<br><br>":""):"i"===t||"em"===t?"<"+n+"em>":q("^("+L+")$")[y](t)?/\bfont-weight:\s*bold\b/[y](r)?"<"+n+"strong>":/\bfont-style:\s*italic\b/[y](r)?"<"+n+"em>":/\btext-decoration:\s*underline\b/[y](r)?"<"+n+"u>":"<"+n+t+r+">":q("^("+N+")$")[y](t)?"<br>":""}),e=e[d](/<\/p>\s*<p>/g,"</p><p>")[d](/\s*<br\s*\/?>\s*/g,"<br>")[d](/\n/g,"<br>")[d](/(?:<br>){3,}/g,"<br><br>")[d](/^(?:(?:<br>)+)|(?:(?:<br>)+)$/g,"")[d](/<br><br>/g,"</p><p>")[d](/<p><\/p>/g,""),e=e?"<p>"+e+"</p>":""}function H(){E[o]=D(n[g])[d](/<\/p>\s*<p>/g,"<br><br>")[d](/<\/?p>/g,"")}function M(){n[g]=D(E[o])[d](/<\/p><p>/g,"</p>\n<p>")}function O(e,n,t){function i(e){t.apply(this,[e]),M(),E[m](),e[h]()}var r=w("a");return r[s]=n,r[o]="<span></span>",r.title=e,r.href="javascript:;",r[f]("touchstart",i,!1),r[f]("mousedown",i,!1),[r,t]}function z(e){return(e.key||String.fromCharCode(e.keyCode))[u]()}var K,_,b=this,x={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],text:{b:"Bold",i:"Italic",u:"Underline",x:"Source"},enter:1},C=w("span"),$=w("span"),E=w("span");e[t][r][n.id||n.name||Object.keys(e[t][r]).length]=b,i=i||{};for(_ in x)"undefined"!=typeof i[_]&&(x[_]=i[_]);var j=x.classes[0],B=x.text||{},L=x.tags.join("|"),N="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|pre|t(able|[dh])",S="⌘",T="⇧",U=O(B.b+" ("+S+"+B)",j+"-b",function(){k("bold",E)}),A=O(B.i+" ("+S+"+I)",j+"-i",function(){k("italic",E)}),I=O(B.u+" ("+S+"+U)",j+"-u",function(){k("underline",E)}),R=O(B.x+" ("+S+"+"+T+"+U)",j+"-x",function(){K?(C[s]=C[s][d](/\s+source$/,""),E[m](),K=0):(C[s]+=" source",n[m](),K=1)});return H(),M(),C[s]=j,n[s]=j+"-source",n[p]("spellcheck",!1),$[s]=j+"-tool",E[s]=j+"-content",x.enter&&(E[s]+=" expand"),E[p]("contenteditable",!0),E[p]("spellcheck",!1),E[p]("placeholder",n.placeholder||""),E[f]("paste",function(){v(H,1)},!1),E[f]("keydown",function(e){var s,n=e.ctrlKey,t=e.shiftKey,r=e.keyCode,i=C,o=z(e);if(n&&("b"===o||!t&&66===r))U[1](),e[h]();else if(n&&("i"===o||!t&&73===r))A[1](),e[h]();else if(n&&t&&("u"===o||85===r))R[1](),e[h]();else if(n&&("u"===o||!t&&85===r))I[1](),e[h]();else if(!x.enter&&("enter"===o||!t&&13===r)){for(;i=i[a];)if("form"===i.nodeName[u]()){s=i;break}s&&s.submit()}v(M,1)},!1),n[f]("keydown",function(e){var n=e.ctrlKey,t=e.shiftKey,r=e.keyCode,i=z(e);n&&t&&("u"===i||85===r)&&(R[1](),e[h]()),v(H,1)},!1),$[c](U[0]),$[c](A[0]),$[c](I[0]),$[c](R[0]),C[c](E),n[a][l](C,n),C[c](n),C[c]($),b})}(window,document,"RTE");