/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR 1.0.4
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,t,n){function ee(e){return t[i](e)}function te(e){return e.toLowerCase()}function ne(e){return"undefined"==typeof e}function re(e){return"function"==typeof e}function ie(e,t){return new RegExp(e,t)}var B,L,r="__instance__",i="createElement",f="innerHTML",o="className",s="addEventListener",u="appendChild",a="removeChild",c="parentNode",l="children",p="firstChild",d="insertBefore",g="nodeName",v="getAttribute",b="setAttribute",h="removeAttribute",x="replace",$="value",y="length",w="indexOf",k="preventDefault",C="focus",E="test",N="contenteditable",A="spellcheck",R="placeholder",T="getSelection",j="getRangeAt",_="rangeCount",H="addRange",K="removeAllRanges",D="cloneContents",F="deleteContents",O="selectNodeContents",U="insertNode",q="cloneRange",z="collapse",M="setStartBefore",X="setStartAfter",P=null,Q="ctrlKey",V="shiftKey",Y="keyCode",Z=setTimeout;!function(e){e.version="1.0.4",e[r]={},e.each=function(t,n){return Z(function(){var i,n=e[r];for(i in n)t(n[i],i,n)},0===n?0:n||1),e},e.x="‌"}(e[n]=function(i,m){function de(e){be()[U](ae),me(e)}function ge(){ae[c]&&ae[c][a](ae)}function ve(){return B=e[T]&&e[T]()||{},B[_]&&B||P}function be(e){return B=ve(),B&&B[j](e||0)||P}function he(e,t){if(e){if(B=ve()){var r,i,n=ee("div");for(r=0,i=B[_];i>r;++r)n[u](B[j](r)[D]());return e=n[f],ne(t)||t?Ke(e):e}return""}return ve()+""}function xe(e){B=ve();var n,t=B.focusNode;return t?(3===t.nodeType&&t[c]!==oe&&(t=t[c]),n=te(t[g]),e?n===e?t:P:t):P}function me(e){return(L=be())&&(e=1===e?!0:0===e?!1:e,L[z](e)),S}function $e(e,n){var r,i,o,s,a=ee("div");if(B=ve()){for(L=be(),L[F](),a[f]=e,r=t.createDocumentFragment();i=a[p];)s=r[u](i);o=r[p],L[U](r),s&&(L=L[q](),L[X](s),n===!0?L[M](o):me(n),B[K](),B[H](L))}return o}function ye(t,n){if(t&&t[v](N))try{var o,r=xe("a"),i=he(1)[x](/^<p>|<\/p>$|<a(\s[^<>]*?)?>|<\/a>/g,"");n=n[x](/^\s*javascript:/i,"");var s=n[0],t=e.location.hostname;s="/"===s||"?"===s||"&"===s||-1===n[w]("/"),!t||0!==n[w]("//"+t)&&-1===n[w]("://"+t)||(s=1),n?(r?r[b]("href",n):(o=$e('<a href="'+n+'">'+i+"</a>",!0),be()[O](o)),(r=xe("a"))&&(s?(r[h]("rel"),r[h]("target")):(r[b]("rel","nofollow"),r[b]("target","blank")))):(r&&(i=r[f],r[c][a](r)),$e(i,!0))}catch(u){}}function we(){return B=ve(),B||""===he()?be()[q]()||P:P}function ke(e){return e&&(B=ve())&&(B[K](),B[H](e)),S}function Ce(e,t,n){ne(t)&&(t=-1);var o,s,r=xe(e),i=he(1)[x](ie("^<p>|<\\/p>$|<"+e+"(?:\\s[^<>]*?)?>|<\\/"+e+">","g"),"");return r!==oe&&(0===t||-1===t&&r?(s=r[f],r[c][a](r),o=$e(i||s,!0)):(1===t||-1===t&&!r)&&(o=$e("<"+e+">"+i+"</"+e+">",!0)),o&&(be()[O](o),!i&&n&&$e(n,!0))),o}function Se(e){e.selectionStart=e.selectionEnd=e[$][y],e[C]()}function He(e,t,n,r){function u(e){r.apply(this,[e,S,i]),Fe(),oe[C](),re(Ae)&&Ae(e,S,oe),e[k]()}var i=ee("a");return i[o]=t,i[f]="<span>"+(n[1]||n[0])+"</span>",i.title=e,i.href="javascript:;",r&&(i[s]("touchstart",u,!1),i[s]("mousedown",u,!1)),[i,r]}function Ke(e){return e=e[x](/\r/g,""),e=e[x](/<([\w-]+?)(?:\s[^<>]*?)?>\s*<\/([\w-]+?)>/g,function(e,t,n){return t===n?"":e}),e=e[x](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,t){return"<code>"+t[x](/\n/g,ue)[x](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[x](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,t,n,r){if(n=te(n),!ie("^("+Le+"|"+Te+")$")[E](n))return"";r=r||"";var i=/^(h[1-6]|th)$/[E](n),o=(/^((fig)?caption)$/[E](n),t?"":r);return"br"===n||"p"===n?"<"+t+n+">":"b"===n||"strong"===n||i?"<"+t+"strong"+o+">"+(i&&t?ue+ue:""):"i"===n||"em"===n?"<"+t+"em"+o+">":ie("^("+Le+")$")[E](n)?"<"+t+n+o+">":ie("^("+Te+")$")[E](n)?ue+ue:""}),e=e[x](/<\/p>\s*<p>/g,"</p><p>")[x](/\s*<br\s*\/?>\s*/g,ue)[x](/\n/g,ue)[x](ie("(?:"+ue+"){3,}","g"),ue+ue)[x](ie("^(?:(?:"+ue+")+)|(?:(?:"+ue+")+)$"),"")[x](ie(ue+ue,"g"),"</p><p>")[x](/<p><\/p>/g,""),e=e&&!/^\s*<p>([\s\S]*?)<\/p>\s*$/i[E](e)?"<p>"+e+"</p>":e}function De(){oe[f]=Ke(i[$])[x](/<\/p>\s*<p>/g,ue+ue)[x](/<\/?p>/g,"")}function Fe(){i[$]=Ke(oe[f])[x](/<\/p><p>/g,"</p>\n<p>")}function Ie(e){return te(e.key||String.fromCharCode(e[Y]))}var ce,le,pe,S=this,I="⌘",G="⇧",J={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],tools:["b","i","u","x"],text:{b:["Bold","&#x0042;",I+"+B"],i:["Italic","&#x0049;",I+"+I"],u:["Underline","&#x0055;",I+"+U"],a:["Link","&#x2693;",I+"+L"],x:["Source","&#x22EF;",I+"+"+G+"+X"]},enter:1,x:0,update:0},W=ee("span"),fe=ee("span"),oe=ee("span"),se=ee("span"),ue="<br>",ae=t.createTextNode(e[n].x);S.$=[P,P],S.$$=function(e,t){return L=[ve(),be(t)],ne(e)?L:L[e]},S.d=function(e,t,n){S.$[0]=we();var r=se[l][0];return r[R]=e,r[$]=t,Z(function(){Se(r)},1),ce=n,S.d.v(1),S},S.d.x=function(e){return se.style.display="none",S.is.d=!1,e&&ke(S.$[0]),S},S.d.v=function(e){return se.style.display="block",S.is.d=!0,e&&(S.$[0]=we()),S},e[n][r][i.id||i.name||Object.keys(e[n][r])[y]]=S,m=m||{};for(pe in J)ne(m[pe])||(J[pe]=m[pe]);S.is={view:!0,source:!1,d:!1,e:function(e){return"string"==typeof e?xe(e)?!0:!1:xe()===e}};var Ee=J.enter,Ne=J.x,Ae=J.update,Re=J.classes[0],Be=J.text||{},Le=J.tags.join("|"),Te="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|p(re)?|t(able|[dh])",je=0,_e={b:function(){Ce("strong")},i:function(){Ce("em")},u:function(){Ce("u")},a:function(e){var n,r,t=he();/^[a-z\d]+:\/\/\S+$/[E](t)?ye(oe,t):((n=xe("a"))&&(r=n[v]("href")),S.d("http://",(r?r[x](/\/+$/,""):"http://"+te(t[x](/\s/g,"")))||"",function(e,t,n){ye(oe,n[$])}))},x:function(e){var t=oe.offsetHeight;t&&(i.style.minHeight=t+"px"),je?(S.$[1]=we(),W[o]=W[o][x](/\s+source$/,""),oe[C](),ke(S.$[0]),je=0):(S.$[0]=we(),W[o]+=" source",Se(i),ke(S.$[1]),je=1),S.is.view=!je,S.is.source=!!je,S.d.x(),re(Ne)&&Ne(e,S,je||0)}};S.t=function(e,t,n,r){var i=He(t[0]+(t[2]?" ("+t[2]+")":""),Re+"-t:"+e,t,n);return ne(r)?r=P:0>r&&(r=fe[l][y]+r),fe[d](i[0],fe[l][r]||P),i[0]};for(pe in _e)S.t[pe]=_e[pe],_e[pe]=He(Be[pe][0]+(Be[pe][2]?" ("+Be[pe][2]+")":""),Re+"-t:"+pe,Be[pe],_e[pe]),S.t[pe].e=_e[pe][0];De(),Fe(),W[o]=Re,i[o]=Re+"-source",i[b](A,!1),fe[o]=Re+"-tool",oe[o]=Re+"-view",Ee&&(W[o]+=" expand"),oe[b](N,!0),oe[b](A,!1),oe[b](R,i[R]||""),oe[s]("paste",function(){Z(function(){De();var e=oe[f];oe[f]="",$e(e,0)},1)},!1),oe[s]("keydown",function(e){var o,t=e[Q],n=e[V],r=e[Y],i=W,f=Ie(e);if(!t||n||"b"!==f&&66!==r)if(!t||n||"i"!==f&&73!==r)if(!t||n||"u"!==f&&85!==r)if(!t||n||"l"!==f&&76!==r)if(t&&n&&("x"===f||88===r))_e.x[1](),e[k]();else if(n||"enter"!==f&&13!==r)n||"backspace"!==f&&8!==r||ge();else if(Ee&&(de(1),$e(ue,0),e[k]()),Ee)re(Ee)&&Ee(e,S,oe);else{for(;i=i[c];)if("form"===te(i[g])){o=i;break}o&&o.submit()}else _e.a[1](),e[k]();else _e.u[1](),e[k]();else _e.i[1](),e[k]();else _e.b[1](),e[k]();re(Ae)&&Ae(e,S,oe),Z(Fe,1)},!1),oe[s]("blur",function(){ge(),Fe()}),i[s]("keydown",function(e){var t=e[Q],n=e[V],r=e[Y],f=Ie(e);t&&n&&("x"===f||88===r)?(_e.x[1](),e[k]()):n||"enter"!==f&&13!==r||re(Ee)&&Ee(e,S,i),re(Ae)&&Ae(e,S,i),Z(De,1)},!1),le=J.tools;for(pe in le)_e[le[pe]]&&fe[u](_e[le[pe]][0]);W[u](oe),i[c][d](W,i),W[u](i),W[u](fe),se[o]=Re+"-dialog",se[f]='<input type="text">',S.d.x();var Oe=se[l][0];return Oe[b](A,!1),Oe[s]("keydown",function(e){var t=this,n=e[Q],r=e[V],i=e[Y],f=Ie(e);n||r||"enter"!==f&&13!==i?r||"escape"!==f&&27!==i&&(t[$][y]||"backspace"!==f&&8!==i)||(S.d.x(1),oe[C](),ce=0,e[k]()):(S.d.x(1),oe[C](),ce&&ce(e,S,t),ce=0,re(Ae)&&Ae(e,S,oe),e[k]())},!1),W[u](se),S.container=W,S.view=oe,S.target=S.source=i,S.tool=fe,S.dialog=se,S.config=J,S.c=me,S.e=xe,S.f=Ke,S.i=$e,S.r=ke,S.s=we,S.v=he,S.w=Ce,S.x=function(e,t){ne(e)?ge():de(e)},S})}(window,document,"RTE");