/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,n,t){function v(e,t,r){if(t&&t[p]("contenteditable"))try{n.execCommand(e,r)}catch(i){}}function w(e){return n[i](e)}var r="__instance__",i="createElement",o="innerHTML",s="className",u="toLowerCase",c="addEventListener",f="appendChild",a="parentNode",l="insertBefore",p="getAttribute",b="setAttribute",d="replace",g="value",h="preventDefault",m="focus",y="test",k=setTimeout;!function(e){e.version="1.0.0",e[r]={},e.each=function(n,t){return k(function(){var i,t=e[r];for(i in t)n(t[i],i,t)},0===t?0:t||1),e}}(e[t]=function(n,i){function D(e,n){return new RegExp(e,n)}function H(e){return e=e[d](/\r/g,""),e=e[d](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,n){return"<code>"+n[d](/\n/g,"<br>")[d](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[d](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,n,t,r){if(t=t[u](),!D("^("+T+"|"+S+")$")[y](t))return"";r=r||"";var i=/^(h[1-6]|th)$/[y](t);/^((fig)?caption)$/[y](t);return"br"===t||"p"===t?"<"+n+t+">":"b"===t||"strong"===t||i?"<"+n+"strong>"+(i&&n?"<br><br>":""):"i"===t||"em"===t?"<"+n+"em>":D("^("+T+")$")[y](t)?/\bfont-weight:\s*bold\b/[y](r)?"<"+n+"strong>":/\bfont-style:\s*italic\b/[y](r)?"<"+n+"em>":/\btext-decoration:\s*underline\b/[y](r)?"<"+n+"u>":"<"+n+t+r+">":D("^("+S+")$")[y](t)?"<br>":""}),e=e[d](/<\/p>\s*<p>/g,"</p><p>")[d](/\s*<br\s*\/?>\s*/g,"<br>")[d](/\n/g,"<br>")[d](/(?:<br>){3,}/g,"<br><br>")[d](/^(?:(?:<br>)+)|(?:(?:<br>)+)$/g,"")[d](/<br><br>/g,"</p><p>")[d](/<p><\/p>/g,""),e=e?"<p>"+e+"</p>":""}function M(){E[o]=H(n[g])[d](/<\/p>\s*<p>/g,"<br><br>")[d](/<\/?p>/g,"")}function O(){n[g]=H(E[o])[d](/<\/p><p>/g,"</p>\n<p>")}function q(e,n,t){function i(e){t.apply(this,[e]),O(),E[m](),e[h]()}var r=w("a");return r[s]=n,r[o]="<span></span>",r.title=e,r.href="javascript:;",r[c]("touchstart",i,!1),r[c]("mousedown",i,!1),[r,t]}function X(e){return(e.key||String.fromCharCode(e.keyCode))[u]()}var K,_,p=this,x={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],text:{b:"Bold",i:"Italic",u:"Underline",x:"Source"},enter:1},C=w("span"),$=w("span"),E=w("span");e[t][r][n.id||n.name||Object.keys(e[t][r]).length]=p,i=i||{};for(_ in x)"undefined"!=typeof i[_]&&(x[_]=i[_]);var L=x.classes[0],N=x.text||{},T=x.tags.join("|"),S="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|pre|t(able|[dh])",j="⌘",B="⇧",R=q(N.b+" ("+j+"+B)",L+"-b",function(){v("bold",E)}),A=q(N.i+" ("+j+"+I)",L+"-i",function(){v("italic",E)}),U=q(N.u+" ("+j+"+U)",L+"-u",function(){v("underline",E)}),I=q(N.x+" ("+j+"+"+B+"+U)",L+"-x",function(){K?(C[s]=C[s][d](/\s+source$/,""),E[m](),K=0):(C[s]+=" source",n[m](),K=1)});M(),O(),C[s]=L,n[s]=L+"-source",n[b]("spellcheck",!1),$[s]=L+"-tool",E[s]=L+"-content",x.enter&&(E[s]+=" expand"),E[b]("contenteditable",!0),E[b]("spellcheck",!1),E[b]("placeholder",n.placeholder||""),E[c]("paste",function(){k(M,1)},!1),E[c]("keydown",function(e){var s,n=e.ctrlKey,t=e.shiftKey,r=e.keyCode,i=C,o=X(e);if(n&&("b"===o||!t&&66===r))R[1](),e[h]();else if(n&&("i"===o||!t&&73===r))A[1](),e[h]();else if(n&&t&&("u"===o||85===r))I[1](),e[h]();else if(n&&("u"===o||!t&&85===r))U[1](),e[h]();else if(!x.enter&&("enter"===o||!t&&13===r)){for(;i=i[a];)if("form"===i.nodeName[u]()){s=i;break}s&&s.submit()}k(O,1)},!1),n[c]("keydown",function(e){var n=e.ctrlKey,t=e.shiftKey,r=e.keyCode,i=X(e);n&&t&&("u"===i||85===r)&&(I[1](),e[h]()),k(M,1)},!1),$[f](R[0]),$[f](A[0]),$[f](U[0]),$[f](I[0]),C[f](E),n[a][l](C,n),C[f](n),C[f]($)})}(window,document,"RTE");