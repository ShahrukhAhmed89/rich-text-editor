/*!
 * =======================================================
 *  SIMPLEST RICH TEXT EDITOR 1.0.3
 * =======================================================
 *
 *   Author: Taufik Nurrohman
 *   URL: https://github.com/tovic
 *   License: MIT
 *
 * -- USAGE: ---------------------------------------------
 *
 *   var e = new RTE(document.querySelector('textarea'));
 *
 * -------------------------------------------------------
 *
 */
!function(e,n,t){function O(e){return n[r](e)}function U(e){return e.toLowerCase()}function q(e){return"function"==typeof e}var I,i="__instance__",r="createElement",o="innerHTML",f="className",s="addEventListener",a="appendChild",c="parentNode",l="children",d="firstChild",p="insertBefore",g="nodeName",b="getAttribute",h="setAttribute",v="replace",x="replaceChild",m="value",y="length",k="preventDefault",w="focus",A="test",R="contenteditable",S="spellcheck",E="placeholder",L="getSelection",N="execCommand",_=null,j="ctrlKey",B="shiftKey",K="keyCode",T=setTimeout;!function(e){e.version="1.0.3",e[i]={},e.each=function(n,t){return T(function(){var r,t=e[i];for(r in t)n(t[r],r,t)},0===t?0:t||1),e}}(e[t]=function(r,u){function V(){return I=e[L]&&e[L]()||{},I.rangeCount&&I||_}function W(e){return I=V(),I&&I.getRangeAt(e||0)||_}function Y(e){return V()+""}function Z(e){var i,r,n=W().commonAncestorContainer[c],t=U(n[g]);if(e){if(n=n!==M&&t===e?n:_,!n&&(n=W())&&(n=n[l])){for(i=0,r=n[y];r>i;++i)if(U(n[i][g]||"")===e)return n[i];return _}return n}return t}function ee(e,t,i){if(t&&t[b](R))try{n[N](e,!1,i)}catch(r){}}function ne(e,t){if(e&&e[b](R))try{var r,i=Z("a");t?n[N]("createLink",!1,t):(i&&(i.href="#"),n[N]("unlink",!1,!1),i&&i[c]&&(r=O("div"),r[o]=i[o],i[c][x](r[d],i)))}catch(f){}}function te(){return I=V(),I||""===Y()?W().cloneRange()||_:_}function ie(e){e&&(I=V())&&(I.removeAllRanges(),I.addRange(e))}function re(e){e.selectionStart=e.selectionEnd=e[m][y],e[w]()}function ge(e,n){return new RegExp(e,n)}function be(e){return e=e[v](/\r/g,""),e=e[v](/<code(?:\s[^<>]*?)?>([\s\S]*?)<\/code>/g,function(e,n){return"<code>"+n[v](/\n/g,G)[v](/(\t| {4})/g,"&nbsp;&nbsp;&nbsp;&nbsp;")+"</code>"}),e=e[v](/<(\/?)([\w-]+?)(\s[^<>]*?)?>/g,function(e,n,t,i){if(t=U(t),!ge("^("+ce+"|"+le+")$")[A](t))return"";i=i||"";var r=/^(h[1-6]|th)$/[A](t);/^((fig)?caption)$/[A](t);return"br"===t||"p"===t?"<"+n+t+">":"b"===t||"strong"===t||r?"<"+n+"strong>"+(r&&n?G+G:""):"i"===t||"em"===t?"<"+n+"em>":ge("^("+ce+")$")[A](t)?/\bfont-weight:\s*bold\b/[A](i)?"<"+n+"strong>":/\bfont-style:\s*italic\b/[A](i)?"<"+n+"em>":/\btext-decoration:\s*underline\b/[A](i)?"<"+n+"u>":"<"+n+t+i+">":ge("^("+le+")$")[A](t)?n?"":G:""}),e=e[v](/<\/p>\s*<p>/g,"</p><p>")[v](/\s*<br\s*\/?>\s*/g,G)[v](/\n/g,G)[v](ge("(?:"+G+"){3,}","g"),G+G)[v](ge("^(?:(?:"+G+")+)|(?:(?:"+G+")+)$"),"")[v](ge(G+G,"g"),"</p><p>")[v](/<p><\/p>/g,""),e=e&&!/^\s*<p>([\s\S]*?)<\/p>\s*$/i[A](e)?"<p>"+e+"</p>":e}function he(){M[o]=be(r[m])[v](/<\/p>\s*<p>/g,G+G)[v](/<\/?p>/g,"")}function ve(){r[m]=be(M[o])[v](/<\/p><p>/g,"</p>\n<p>")}function xe(e,n,t,i){function a(e){i.apply(this,[e]),ve(),M[w](),q(se)&&se(e,$,M),e[k]()}var r=O("a");return r[f]=n,r[o]="<span>"+(t[1]||t[0])+"</span>",r.title=e,r.href="javascript:;",r[s]("touchstart",a,!1),r[s]("mousedown",a,!1),[r,i]}function me(e){return U(e.key||String.fromCharCode(e[K]))}var J,P,Q,$=this,C="⌘",H="⇧",z={classes:["rich-text-editor"],tags:["a","abbr","b","br","code","del","em","i","ins","kbd","mark","p","span","strong","u"],tools:["b","i","u","x"],text:{b:["Bold","&#x0042;",C+"+B"],i:["Italic","&#x0049;",C+"+I"],u:["Underline","&#x0055;",C+"+U"],a:["Link","&#x2693;",C+"+L"],x:["Source","&#x22EF;",C+"+"+H+"+X"]},enter:1,x:0,update:0},D=O("span"),F=O("span"),M=O("span"),X=O("span"),G="<br>";$.$=[_,_],$.s=te,$.r=ie,$.d=function(e,n,t){$.$[0]=te();var i=X[l][0];return i[E]=e,i[m]=n,T(function(){re(i)},1),J=t,$.d.v(),$},$.d.x=function(){return X.style.display="none",$},$.d.v=function(){return X.style.display="block",$},e[t][i][r.id||r.name||Object.keys(e[t][i])[y]]=$,u=u||{};for(Q in z)"undefined"!=typeof u[Q]&&(z[Q]=u[Q]);var oe=z.enter,fe=z.x,se=z.update,ae=z.classes[0],ue=z.text||{},ce=z.tags.join("|"),le="blockquote|(fig)?caption|figure|h[1-6]|div|li|[ou]l|pre|t(able|[dh])",de=0,pe={b:function(){ee("bold",M)},i:function(){ee("italic",M)},u:function(){ee("underline",M)},a:function(e){var t,n=Y();/^[a-z\d]+:\/\/\S+$/[A](n)?ne(M,n):(t=Z("a"),$.d("http://",(t?t.href[v](/\/+$/,""):"http://"+U(n[v](/\s/g,"")))||"",function(e,n,t){ne(M,t[m])}))},x:function(e){var n=M.offsetHeight;n&&(r.style.minHeight=n+"px"),de?($.$[1]=te(),D[f]=D[f][v](/\s+source$/,""),M[w](),ie($.$[0]),de=0):($.$[0]=te(),D[f]+=" source",re(r),ie($.$[1]),de=1),$.d.x(),q(fe)&&fe(e,$,de||0)}};for(Q in pe)pe[Q]=xe(ue[Q][0]+(ue[Q][2]?" ("+ue[Q][2]+")":""),ae+"-"+Q,ue[Q],pe[Q]);he(),ve(),D[f]=ae,r[f]=ae+"-source",r[h](S,!1),F[f]=ae+"-tool",M[f]=ae+"-view",oe&&(D[f]+=" expand"),M[h](R,!0),M[h](S,!1),M[h](E,r[E]||""),M[s]("paste",function(){T(he,1)},!1),M[s]("keydown",function(e){var f,n=e[j],t=e[B],i=e[K],r=D,o=me(e);if(!n||t||"b"!==o&&66!==i)if(!n||t||"i"!==o&&73!==i)if(!n||t||"u"!==o&&85!==i)if(!n||t||"l"!==o&&76!==i){if(n&&t&&("x"===o||88===i))pe.x[1](),e[k]();else if(!t&&("enter"===o||13===i)){var s=V(),a=W(),u=O("br");if(oe&&a&&(a.deleteContents(),a.insertNode(u),a.setStartAfter(u),a.setEndAfter(u),s.removeAllRanges(),s.addRange(a),e[k]()),oe)q(oe)&&oe(e,$,M);else{for(;r=r[c];)if("form"===U(r[g])){f=r;break}f&&f.submit()}}}else pe.a[1](),e[k]();else pe.u[1](),e[k]();else pe.i[1](),e[k]();else pe.b[1](),e[k]();q(se)&&se(e,$,M),T(ve,1)},!1),r[s]("keydown",function(e){var n=e[j],t=e[B],i=e[K],o=me(e);n&&t&&("x"===o||88===i)?(pe.x[1](),e[k]()):t||"enter"!==o&&13!==i||q(oe)&&oe(e,$,r),q(se)&&se(e,$,r),T(he,1)},!1),P=z.tools;for(Q in P)pe[P[Q]]&&F[a](pe[P[Q]][0]);return D[a](M),r[c][p](D,r),D[a](r),D[a](F),X[f]=ae+"-dialog",X[o]='<input type="text">',$.d.x(),X[l][0][h](S,!1),X[l][0][s]("keydown",function(e){var n=this,t=e[j],i=e[B],r=e[K],o=me(e);t||i||"enter"!==o&&13!==r?i||"escape"!==o&&27!==r&&(n[m][y]||"backspace"!==o&&8!==r)||($.d.x(),M[w](),ie($.$[0]),e[k]()):($.d.x(),M[w](),ie($.$[0]),J&&(J(e,$,n),J=0,e[k]()))},!1),D[a](X),$.container=D,$.tool=F,$.view=M,$.target=$.source=r,$.dialog=X,$})}(window,document,"RTE");